!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.Ebanx=r():e.Ebanx=r()}(this,function(){return function(e){function r(n){if(t[n])return t[n].exports;var a=t[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,r),a.loaded=!0,a.exports}var t={};return r.m=e,r.c=t,r.p="",r(0)}([function(e,r){"use strict";var t=function(){var e={},r={mode:"test",publicKey:""};if(e.config=function(){return{isLive:"production"===r.mode,setPublishableKey:function(e){t.validator.config.validatePublishableKey(e,function(){r.publicKey=String(e)})},getPublishableKey:function(){if(""===r.publicKey.trim())throw new t.errors.InvalidConfigurationError("Missing publishable key. You need set publishable key using the method Ebanx.config.setPublishableKey.","publicKey");return r.publicKey}}}(),e.config.isLive&&"https:"!==location.protocol)throw"EbanxInvalidConfigurationError: Your protocol needs to be https.";return e}();t.errors=function(){return{InvalidValueFieldError:function(e,r){this.message=e,this.field=r,this.name="InvalidValueFieldError"},InvalidConfigurationError:function(e,r){this.message=e,this.invalidConfiguration=r,this.name="InvalidConfigurationError"},ResponseError:function(e){this.message=e.message}}}(),t.validator=function(){return{config:{validatePublishableKey:function(e,r){var n=t.utils.api.resources.validPublicIntegrationKey;t.http.ajax.request({url:n.url,method:n.method,data:{public_integration_key:e}}).always(function(e){r(e)})}},card:{validateNumber:function(e){var r=/^3[47][0-9]{13}$|^50[0-9]{14,17}$|^(636368|438935|504175|451416|636297|5067|4576|4011|50904|50905|50906)|^3(?:0[0-5]|[68][0-9])[0-9]{11}$|^6(?:011|5[0-9]{2})[0-9]{12}$|^(38|60)[0-9]{11,17}$|^5[1-5][0-9]{14}$|^4[0-9]{12}(?:[0-9]{3})?$/;if(!r.test(e)||!this.luhnAlgCheck(String(e)))throw new t.errors.InvalidValueFieldError("Invalid card number.","card_number")},luhnAlgCheck:function(e){var r,t,n,a;for(n=+e[r=e.length-1],a=0;r--;)t=+e[r],n+=++a%2?2*t%10+(t>4):t;return n%10===0},validateCvv:function(e){var r=new RegExp("^[0-9]{3}$");if(!r.test(e))throw new t.errors.InvalidValueFieldError("Invalid card cvv.","card_cvv")},validateDueDate:function(e){var r=(e+"").split("/");if(r={now:new Date,year:r[1],month:r[0]},/^\d+$/.test(r.month)!==!0||parseInt(r.month,10)<=12!=!0)throw new t.errors.InvalidValueFieldError("Invalid month to card due_date.","card_due_date");if(!/^\d+$/.test(r.year))throw new t.errors.InvalidValueFieldError("Invalid year to card due_date.","card_due_date");if(r.expiration=new Date(r.year,r.month),r.expiration.setMonth(r.expiration.getMonth()-1),r.expiration.setMonth(r.expiration.getMonth()+1,1),r.expiration>r.now!=!0)throw new t.errors.InvalidValueFieldError("Invalid card due_date.","card_due_date")},validate:function(e){this.validateCvv(e.card_cvv),this.validateNumber(e.card_number),this.validateDueDate(e.card_due_date),t.validator.customer.validateCountry(e.country)}},customer:{validateCountry:function(e){if(t.utils.availableCountries.indexOf(e)===-1)throw new t.errors.InvalidValueFieldError("Invalid customer country. You can use one of them: "+t.utils.availableCountries+".","country")}}}}(),t.tokenize=function(){return{card:{token:function(e,r){var n=t.utils.api.resources.createToken;t.http.ajax.request({url:n.url,method:n.method,json:!0,data:{request_body:JSON.stringify({public_integration_key:t.config.getPublishableKey(),payment_type_code:t.utils.creditCardScheme(e.card_number),country:e.country,card:e})}}).always(function(e){if("ERROR"===e.status||!("token"in e))throw new t.errors.ResponseError(e.status_message||"Error to tokenize.");r(e)})}}}}(),t.utils=function(){var e={api:{url:(t.config.isLive,"http://dev-pay.ebanx.com/ws")},availableCountries:["br","cl","co","mx","pe"].join(", "),creditCardScheme:function(e){t.validator.card.validateNumber(e);var r={amex:/^3[47][0-9]{13}$/,aura:/^50[0-9]{14,17}$/,elo:/^(636368|438935|504175|451416|636297|5067|4576|4011|50904|50905|50906)/,diners:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,discover:/^6(?:011|5[0-9]{2})[0-9]{12}$/,hipercard:/^(38|60)[0-9]{11,17}$/,mastercard:/^5[1-5][0-9]{14}$/,visa:/^4[0-9]{12}(?:[0-9]{3})?$/};for(var n in r)if(r[n].test(e))return n;throw new t.errors.InvalidValueFieldError("Credit card scheme not found.","card_number")}};return e.api.resources={createToken:{url:e.api.url+"/token",method:"get"},validPublicIntegrationKey:{url:e.api.url+"/merchantIntegrationProperties/isValidPublicIntegrationKey",method:"get"}},e}(),t.http=function(){return{normalize:{q:function(e,r){var t,n=[];for(var a in e)n.push(a+"="+encodeURIComponent(e[a]));return t=n.join("&"),""!==t?r?r.indexOf("?")<0?"?"+t:"&"+t:t:""}},ajax:{request:function(e){"string"==typeof e&&(e={url:e}),e.url=e.url||"",e.method=e.method||"get",e.data=e.data||{};var r={host:{},process:function(e){var r=this;return this.xhr=null,window.ActiveXObject?this.xhr=new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(this.xhr=new XMLHttpRequest),this.xhr&&(this.xhr.onreadystatechange=function(){if(4==r.xhr.readyState){var t=r.xhr.responseText||"{}";e.json===!0&&"undefined"!=typeof JSON&&(t=JSON.parse(t)),r.alwaysCallback&&r.alwaysCallback.apply(r.host,[t,r.xhr])}}),"get"===e.method.toLowerCase()?this.xhr.open("GET",""+e.url+t.http.normalize.q(e.data,e.url),!0):this.xhr.open(e.method.toUpperCase(),e.url,!0),setTimeout(function(){r.xhr.send()},20),this},always:function(e){return this.alwaysCallback=e,this}};return r.process(e)}}}}(),t.card=function(){var e={};return e.createToken=function(e,r){var n={data:{},error:{}};try{t.validator.card.validate(e),t.tokenize.card.token(e,function(e){n.data=e,r(n)})}catch(a){a instanceof t.errors.InvalidValueFieldError,n.error.err=a,r(n)}},e}(),e.exports=t}])});