!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Ebanx=t():e.Ebanx=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){var e={},t={mode:"test",publicKey:""};if(e.config=function(){return{isLive:"production"===t.mode,setPublishableKey:function(e){n.validator.config.validatePublishableKey(e),t.publicKey=String(e)},getPublishableKey:function(){if(""===t.publicKey.trim())throw new n.errors.InvalidConfigurationError("Missing publishable key. You need set publishable key using the method Ebanx.config.setPublishableKey.","publicKey");return t.publicKey}}}(),e.config.isLive&&"https:"!==location.protocol)throw"EbanxInvalidConfigurationError: Your protocol needs to be https.";return e}();n.errors=function(){return{InvalidValueFieldError:function(e,t){this.message=e,this.field=t,this.name="InvalidValueFieldError"},InvalidConfigurationError:function(e,t){this.message=e,this.invalidConfiguration=t,this.name="InvalidConfigurationError"},ResponseError:function(e){this.message=e.message}}}(),n.validator=function(){return{config:{validatePublishableKey:function(e){var t=new RegExp("^[0-9]{7}$");if(!t.test(e))throw new n.errors.InvalidValueFieldError("Invalid PublishableKey.","PublishableKey")}},card:{validateNumber:function(e){var t=new RegExp("^[0-9]{16}$");if(!t.test(e)||!this.luhnAlgCheck(e))throw new n.errors.InvalidValueFieldError("Invalid card number.","card_number")},luhnAlgCheck:function(e){e=(e+"").replace(/\s+|-/g,"");for(var t=0,r=0;r<e.length;r++){var n=parseInt(e.substr(r,1));r%2===0&&(n*=2,n>9&&(n=1+n%10)),t+=n}return t%10===0},validateCvv:function(e){var t=new RegExp("^[0-9]{3}$");if(!t.test(e))throw new n.errors.InvalidValueFieldError("Invalid card cvv.","card_cvv")},validateDueDate:function(e){var t=(e+"").split("/");if(t={now:new Date,year:t[1],month:t[0]},/^\d+$/.test(t.month)!==!0||parseInt(t.month,10)<=12!=!0)throw new n.errors.InvalidValueFieldError("Invalid month to card due_date.","card_due_date");if(!/^\d+$/.test(t.year))throw new n.errors.InvalidValueFieldError("Invalid year to card due_date.","card_due_date");if(t.expiration=new Date(t.year,t.month),t.expiration.setMonth(t.expiration.getMonth()-1),t.expiration.setMonth(t.expiration.getMonth()+1,1),t.expiration>t.now!=!0)throw new n.errors.InvalidValueFieldError("Invalid card due_date.","card_due_date")},validate:function(e){this.validateCvv(e.card_cvv),this.validateNumber(e.card_number),this.validateDueDate(e.card_due_date),n.validator.customer.validateCountry(e.country)}},customer:{validateCountry:function(e){if(n.utils.availableCountries.indexOf(e)===-1)throw new n.errors.InvalidValueFieldError("Invalid customer country. You can use one of them: "+n.utils.availableCountries+".","country")}}}}(),n.tokenize=function(){return{card:{token:function(e,t){var r=n.utils.api.resources.createToken;n.http.ajax.request({url:r.url,method:r.method,json:!0,data:{payment_type_code:"visa",country:e.country,card:e},headers:{"Content-type":"application/json"}}).always(function(e){"ERROR"!==e.status&&"token"in e||console.log("ERRO"),t(e)})}}}}(),n.utils=function(){var e={api:{url:(n.config.isLive,"http://dev-pay.ebanx.com/ws")},availableCountries:["br","cl","co","mx","pe"].join(", ")};return e.api.resources={createToken:{url:e.api.url+"/token",method:"post"}},e}(),n.http=function(){return{normalize:{q:function(e,t){var r,n=[];for(var o in e)n.push(o+"="+encodeURIComponent(e[o]));return r=n.join("&"),""!==r?t?t.indexOf("?")<0?"?"+r:"&"+r:r:""}},ajax:{request:function(e){"string"==typeof e&&(e={url:e}),e.url=e.url||"",e.method=e.method||"get",e.data=e.data||{},e.data.integration_key=n.config.getPublishableKey();var t={host:{},process:function(e){var t=this;return this.xhr=null,window.ActiveXObject?this.xhr=new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(this.xhr=new XMLHttpRequest),this.xhr&&(this.xhr.onreadystatechange=function(){if(4==t.xhr.readyState){var r=t.xhr.responseText||"{}";e.json===!0&&"undefined"!=typeof JSON&&(r=JSON.parse(r)),200==t.xhr.status?t.doneCallback&&t.doneCallback.apply(t.host,[r,t.xhr]):t.failCallback&&t.failCallback.apply(t.host,[r,t.xhr]),t.alwaysCallback&&t.alwaysCallback.apply(t.host,[r,t.xhr])}}),"get"===e.method.toLowerCase()?this.xhr.open("GET",""+e.url+n.http.normalize.q(e.data,e.url),!0):(this.xhr.open(e.method.toUpperCase(),e.url,!0),this.setHeaders({"X-Requested-With":"XMLHttpRequest","Content-type":"application/x-www-form-urlencoded"})),e.headers&&"object"==r(e.headers)&&this.setHeaders(e.headers),setTimeout(function(){"get"==e.method?t.xhr.send():t.xhr.send(e.json?JSON.stringify(e.data):n.http.normalize.q(e.data))},20),this},done:function(e){return this.doneCallback=e,this},fail:function(e){return this.failCallback=e,this},always:function(e){return this.alwaysCallback=e,this},setHeaders:function(e){for(var t in e)this.xhr&&this.xhr.setRequestHeader(t.toLowerCase(),e[t])}};return t.process(e)}}}}(),n.card=function(){var e={};return e.createToken=function(e,t){var r={data:{},error:{}};try{n.validator.card.validate(e),n.tokenize.card.token(e,function(e){r.data=e,t(r)})}catch(o){o instanceof n.errors.InvalidValueFieldError,r.error.err=o,t(r)}},e}(),e.exports=n}])});