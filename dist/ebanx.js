!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Ebanx=t():e.Ebanx=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t){"use strict";var r=function(){var e={},t={mode:"test",publicKey:""};if(e.config=function(){return{isLive:"production"===t.mode,setPublishableKey:function(e){r.validator.config.validatePublishableKey(e,function(){t.publicKey=String(e)})},getPublishableKey:function(){if(""===t.publicKey.trim())throw new r.errors.InvalidConfigurationError("Missing publishable key. You need set publishable key using the method Ebanx.config.setPublishableKey.","publicKey");return t.publicKey}}}(),e.config.isLive&&"https:"!==location.protocol)throw"EbanxInvalidConfigurationError: Your protocol needs to be https.";return e}();r.errors=function(){return{InvalidValueFieldError:function(e,t){this.message=e,this.field=t,this.name="InvalidValueFieldError"},InvalidConfigurationError:function(e,t){this.message=e,this.invalidConfiguration=t,this.name="InvalidConfigurationError"},ResponseError:function(e){this.message=e.message}}}(),r.validator=function(){return{config:{validatePublishableKey:function(e,t){var n=r.utils.api.resources.validPublicIntegrationKey;r.http.ajax.request({url:n.url,method:n.method,data:{public_integration_key:e}}).always(function(e){t(e)})}},card:{validateNumber:function(e){var t=/^3[47][0-9]{13}$|^50[0-9]{14,17}$|^(636368|438935|504175|451416|636297|5067|4576|4011|50904|50905|50906)|^3(?:0[0-5]|[68][0-9])[0-9]{11}$|^6(?:011|5[0-9]{2})[0-9]{12}$|^(38|60)[0-9]{11,17}$|^5[1-5][0-9]{14}$|^4[0-9]{12}(?:[0-9]{3})?$/;if(!t.test(e)||!this.luhnAlgCheck(String(e)))throw new r.errors.InvalidValueFieldError("Invalid card number.","card_number")},luhnAlgCheck:function(e){var t,r,n,a;for(n=+e[t=e.length-1],a=0;t--;)r=+e[t],n+=++a%2?2*r%10+(r>4):r;return n%10===0},validateCvv:function(e){var t=new RegExp("^[0-9]{3}$");if(!t.test(e))throw new r.errors.InvalidValueFieldError("Invalid card cvv.","card_cvv")},validateDueDate:function(e){var t=(e+"").split("/");if(t={now:new Date,year:t[1],month:t[0]},/^\d+$/.test(t.month)!==!0||parseInt(t.month,10)<=12!=!0)throw new r.errors.InvalidValueFieldError("Invalid month to card due_date.","card_due_date");if(!/^\d+$/.test(t.year))throw new r.errors.InvalidValueFieldError("Invalid year to card due_date.","card_due_date");if(t.expiration=new Date(t.year,t.month),t.expiration.setMonth(t.expiration.getMonth()-1),t.expiration.setMonth(t.expiration.getMonth()+1,1),t.expiration>t.now!=!0)throw new r.errors.InvalidValueFieldError("Invalid card due_date.","card_due_date")},validate:function(e){this.validateCvv(e.card_cvv),this.validateNumber(e.card_number),this.validateDueDate(e.card_due_date),r.validator.customer.validateCountry(e.country)}},customer:{validateCountry:function(e){if(r.utils.availableCountries.indexOf(e)===-1)throw new r.errors.InvalidValueFieldError("Invalid customer country. You can use one of them: "+r.utils.availableCountries+".","country")}}}}(),r.tokenize=function(){return{card:{token:function(e,t){var n=r.utils.api.resources.createToken;r.http.ajax.request({url:n.url,method:n.method,json:!0,data:{request_body:JSON.stringify({public_integration_key:r.config.getPublishableKey(),payment_type_code:"visa",country:e.country,card:e})}}).always(function(e){"ERROR"===e.status||!("token"in e),t(e)})}}}}(),r.utils=function(){var e={api:{url:(r.config.isLive,"http://dev-pay.ebanx.com/ws")},availableCountries:["br","cl","co","mx","pe"].join(", "),creditCardScheme:function(e){r.validator.card.validateNumber(e);var t={amex:/^3[47][0-9]{13}$/,aura:/^50[0-9]{14,17}$/,elo:/^(636368|438935|504175|451416|636297|5067|4576|4011|50904|50905|50906)/,diners:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,discover:/^6(?:011|5[0-9]{2})[0-9]{12}$/,hipercard:/^(38|60)[0-9]{11,17}$/,mastercard:/^5[1-5][0-9]{14}$/,visa:/^4[0-9]{12}(?:[0-9]{3})?$/};for(var n in t)if(t[n].test(e))return n;throw new r.errors.InvalidValueFieldError("Credit card scheme not found.","card_number")}};return e.api.resources={createToken:{url:e.api.url+"/token",method:"get"},validPublicIntegrationKey:{url:e.api.url+"/merchantIntegrationProperties/isValidPublicIntegrationKey",method:"get"}},e}(),r.http=function(){return{normalize:{q:function(e,t){var r,n=[];for(var a in e)n.push(a+"="+encodeURIComponent(e[a]));return r=n.join("&"),""!==r?t?t.indexOf("?")<0?"?"+r:"&"+r:r:""}},ajax:{request:function(e){"string"==typeof e&&(e={url:e}),e.url=e.url||"",e.method=e.method||"get",e.data=e.data||{};var t={host:{},process:function(e){var t=this;return this.xhr=null,window.ActiveXObject?this.xhr=new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(this.xhr=new XMLHttpRequest),this.xhr&&(this.xhr.onreadystatechange=function(){if(4==t.xhr.readyState){var r=t.xhr.responseText||"{}";e.json===!0&&"undefined"!=typeof JSON&&(r=JSON.parse(r)),t.alwaysCallback&&t.alwaysCallback.apply(t.host,[r,t.xhr])}}),"get"===e.method.toLowerCase()?this.xhr.open("GET",""+e.url+r.http.normalize.q(e.data,e.url),!0):this.xhr.open(e.method.toUpperCase(),e.url,!0),setTimeout(function(){t.xhr.send()},20),this},always:function(e){return this.alwaysCallback=e,this}};return t.process(e)}}}}(),r.card=function(){var e={};return e.createToken=function(e,t){var n={data:{},error:{}};try{r.validator.card.validate(e),r.tokenize.card.token(e,function(e){n.data=e,t(n)})}catch(a){a instanceof r.errors.InvalidValueFieldError,n.error.err=a,t(n)}},e}(),e.exports=r}])});