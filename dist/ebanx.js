!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.EBANX=r():e.EBANX=r()}(this,function(){return function(e){function r(i){if(t[i])return t[i].exports;var n=t[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}var t={};return r.m=e,r.c=t,r.p="",r(0)}([function(e,r){var t=function(){var e={},r={country:"",mode:"test",publicKey:""};if(e.config=function(){return{isLive:function(){return"production"===r.mode},setPublishableKey:function(e){r.publicKey=String(e)},setCountry:function(e){t.validator.config.validateCountry(e),r.country=String(e)},setMode:function(e){t.validator.config.validateMode(e),r.mode=e},getMode:function(){return r.mode},getPublishableKey:function(){if(""===r.publicKey.trim())throw new t.errors.InvalidConfigurationError("Missing publishable key. You need set publishable key using the method EBANX.config.setPublishableKey.","publicKey");return r.publicKey},getCountry:function(){return r.country||(r.country="br"),r.country},getLocale:function(){var e={br:"pt_BR",mx:"es",co:"es",ar:"es"};return e[t.config.getCountry()]}}}(),e.config.isLive()&&"https:"!==location.protocol)throw"EBANXInvalidConfigurationError: Your protocol needs to be https.";return e}();t.errors=function(){return{summary:{pt_BR:{"BP-DR-76":"País não informado.","BP-DR-77":"País não permitido.","BP-DR-75":"O número do cartão de crédito é inválido.","BP-DR-S-75":"A bandeira do cartão de crédito é inválida.","BP-DR-51":"Insira o nome que está impresso no cartão de crédito.","BP-DR-55":"O código do cartão de crédito é inválido.","BP-DR-57":"A data do cartão de crédito deve estar no formato mes/ano, por exemplo, 12/2020.","BP-DR-M-57":"O mês data do cartão de crédito é inválido.","BP-DR-Y-57":"O ano data do cartão de crédito é inválido."},es:{"BP-DR-76":"País não informado.","BP-DR-77":"País não permitido.","BP-DR-75":"El número de tarjeta de crédito es inválido.","BP-DR-S-75":"El bandera de tarjeta de crédito es inválido.","BP-DR-51":"Por favor, introduce el nombre como está en tu tarjeta de crédito.","BP-DR-55":"El código de tarjeta de crédito es inválido.","BP-DR-57":"Por favor, escribe la fecha en el formato MM/AAAA.","BP-DR-M-57":"El mes de tarjeta de crédito es inválido.","BP-DR-Y-57":"El año de tarjeta de crédito es inválido."}},InvalidValueFieldError:function(e,r){this.message=t.errors.summary[t.config.getLocale()][e]||e,this.field=r,this.name="InvalidValueFieldError"},InvalidConfigurationError:function(e,r){this.message=t.errors.summary[t.config.getLocale()][e]||e,this.invalidConfiguration=r,this.name="InvalidConfigurationError"}}}(),t.validator=function(){var e={publicKey:{}};return{config:{validatePublishableKey:function(r,i){var n=t.utils.api.resources.validPublicIntegrationKey();return e.publicKey[r]?void i(e.publicKey[r]):void t.http.ajax.request({url:n.url,method:n.method,raw:!0,data:{public_integration_key:r}}).always(function(t){e.publicKey[r]=t,i(t)})},validateCountry:function(e){if(t.utils.availableCountries.indexOf(e)===-1)throw new t.errors.InvalidValueFieldError("BP-DR-77","country")},validateMode:function(e){if(null===e.match(/^(test|production)$/))throw new t.errors.InvalidConfigurationError('Invalid mode, please, use "test" or "production" as test mode.',"mode")}},card:{validateNumber:function(e){var r=/^3[47][0-9]{13}$|^50[0-9]{14,17}$|^(636368|438935|504175|451416|636297|5067|4576|4011|50904|50905|50906)|^3(?:0[0-5]|[68][0-9])[0-9]{11}$|^6(?:011|5[0-9]{2})[0-9]{12}$|^(38|60)[0-9]{11,17}$|^5[1-5][0-9]{14}$|^4[0-9]{12}(?:[0-9]{3})?$/;if(!r.test(e)||!this.luhnAlgCheck(String(e)))throw new t.errors.InvalidValueFieldError("BP-DR-75","card_number")},validateName:function(e){if("string"!=typeof e||0===e.length||null!==e.match(/[0-9]+/))throw new t.errors.InvalidValueFieldError("BP-DR-51","card_name")},luhnAlgCheck:function(e){var r,t,i,n;for(i=+e[r=e.length-1],n=0;r--;)t=+e[r],i+=++n%2?2*t%10+(t>4):t;return i%10===0},validateCvv:function(e){var r=new RegExp("^[0-9]{3,4}$");if(!String(e).match(r))throw new t.errors.InvalidValueFieldError("BP-DR-55","card_cvv")},validateDueDate:function(e){var r=(e+"").split("/");if(r={now:new Date,year:r[1],month:r[0]},/^\d+$/.test(r.month)!==!0||parseInt(r.month,10)<=12!=!0)throw new t.errors.InvalidValueFieldError("BP-DR-M-57","card_due_date");if(!/^\d+$/.test(r.year))throw new t.errors.InvalidValueFieldError("BP-DR-Y-57","card_due_date");if(r.expiration=new Date(r.year,r.month),r.expiration.setMonth(r.expiration.getMonth()-1),r.expiration.setMonth(r.expiration.getMonth()+1,1),r.expiration>r.now!=!0)throw new t.errors.InvalidValueFieldError("BP-DR-57","card_due_date")},validate:function(e){this.validateName(e.card_name),this.validateNumber(e.card_number),this.validateDueDate(e.card_due_date),this.validateCvv(e.card_cvv)}}}}(),t.tokenize=function(){return{card:{token:function(e,r,i){var n=t.utils.api.resources.createToken();t.http.ajax.request({url:n.url,method:n.method,data:JSON.stringify({public_integration_key:t.config.getPublishableKey(),payment_type_code:t.utils.creditCardScheme(e.card_number),country:t.config.getCountry(),card:e})}).always(function(e){return"ERROR"!==e.status&&"token"in e?r(e):i(e)})}}}}(),t.utils=function(){var e={api:{path:function(){return t.config.isLive()?"https://api.ebanx.com/":"https://sandbox.ebanx.com/"}},availableCountries:["br","mx","co","ar"].join(", "),creditCardScheme:function(e){t.validator.card.validateNumber(e);var r={br:{aura:/^50[0-9]{14,17}$/,elo:/^(636368|438935|504175|451416|636297|5067|4576|4011|50904|50905|50906)/,diners:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,discover:/^6(?:011|5[0-9]{2})[0-9]{12}$/,hipercard:/^(38|60)[0-9]{11,17}$/},mx:{carnet:/^5[6-9][0-9]{14}$/,mastercard__2:/^2[2-7][0-9]{14}$/},co:{diners:/^36[0-9]{12}$/},ar:{mastercard__all:/^[0-9]{16}$/},all:{amex:/^3[47][0-9]{13}$/,mastercard:/^5[1-5][0-9]{14}$/,visa:/^4[0-9]{12}(?:[0-9]{3})?$/}},i={};for(var n in r[t.config.getCountry()])i[n]=r[t.config.getCountry()][n];for(var n in r.all)i[n]=r.all[n];for(var o in i)if(i[o].test(e)){var a=o,s=o.indexOf("__");return s!==-1&&(a=o.substr(0,s)),a}throw new t.errors.InvalidValueFieldError("BP-DR-S-75","card_number")}};return e.api.url=function(){return e.api.path()+"ws"},e.api.resources={createToken:function(){return{url:e.api.url()+"/token",method:"post"}},validPublicIntegrationKey:function(){return{url:e.api.url()+"/merchantIntegrationProperties/isValidPublicIntegrationKey",method:"get"}},fingerPrintResource:function(){return{url:e.api.path()+"fingerprint/",method:"get"}},fingerPrintProvidersResource:function(){return{url:e.api.path()+"fingerprint/provider",method:"get"}}},e}(),t.http=function(){return{normalize:{q:function(e,r){function t(e,r){var i=[];return r=r||[],Object.keys(e).forEach(function(n){if(e.hasOwnProperty(n)){var o=r.slice();o.push(n);var a=[];"object"==typeof e[n]?a=t(e[n],o):a.push({path:o,val:e[n]}),a.forEach(function(e){return i.push(e)})}}),i}var i=t(e);i=i.map(function(e){if(1==e.path.length)e.path=e.path[0];else{var r=e.path[0],t=e.path.slice(1);e.path=r+"["+t.join("][")+"]"}return e});var n=i.map(function(e){return e.path+"="+e.val}).join("&");return r?encodeURIComponent(n):n}},ajax:{request:function(e){"string"==typeof e&&(e={url:e}),e.url=e.url||"",e.method=e.method||"get",e.data=e.data||{};var r={host:{},process:function(e){var r=this;return this.xhr=null,window.ActiveXObject?this.xhr=new window.ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(this.xhr=new XMLHttpRequest),this.xhr&&(this.xhr.onreadystatechange=function(){if(4==r.xhr.readyState){var t=r.xhr.responseText||"{}";"undefined"==typeof e.raw&&"undefined"!=typeof JSON&&(t=JSON.parse(t)),r.alwaysCallback&&r.alwaysCallback.apply(r.host,[t,r.xhr])}}),"GET"==e.method.toUpperCase()&&(e.url+="?"+t.http.normalize.q(e.data),delete e.data),this.xhr.open(e.method.toUpperCase(),e.url,!0),setTimeout(function(){r.xhr.send(e.data)},20),this},always:function(e){return this.alwaysCallback=e,this}};return r.process(e)}},injectJS:function(e,r){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.onload=r,t.src=e,document.getElementsByTagName("head")[0].appendChild(t)}}}(),t.card=function(){var e={};return e.createToken=function(e,r){var i={data:{},error:{}},n=function(e){i.data=e,t.deviceFingerprint.setup(function(e){return i.data.deviceId=e,r(i)})},o=function(e){return i.error.err=e,r(i)},a="";try{a=t.config.getPublishableKey()}catch(e){i.error.err=e,r(i)}t.validator.config.validatePublishableKey(a,function(a){var s=JSON.parse(a);if(!s.success)return i.error.err={status:"ERROR",status_code:"",status_message:s.body.error},void r(i);try{t.validator.card.validate(e),t.tokenize.card.token(e,n,o)}catch(e){i.error.err=e,r(i)}})},e}(),t.deviceFingerprint={ebanx_session_id:null,providerSessionList:[],providerPostPending:null,setup:function(e){var r=this;this.getList(function(i){i&&i.ebanx_session_id&&(t.deviceFingerprint.ebanx_session_id=i.ebanx_session_id,e(i.ebanx_session_id),i.providers.forEach(function(e){r.getProviderSessionId(e)}))})},getList:function(e){t.http.ajax.request({url:t.utils.api.resources.fingerPrintResource().url,data:{publicIntegrationKey:t.config.getPublishableKey(),country:t.config.getCountry()}}).always(e)},getProviderSessionId:function(e){this.loadProvider(e,this.saveProviderSessionList)},saveProviderSessionList:function(e){var r=t.deviceFingerprint;r.providerPostPending&&clearTimeout(r.providerPostPending),r.providerSessionList.push(e),r.providerPostPending=setTimeout(r.postProviderSessionList,1e3)},postProviderSessionList:function(){var e=t.deviceFingerprint,r=e.providerSessionList;e.providerSessionList=[],clearTimeout(e.providerPostPending),e.providerPostPending=null;var i={publicIntegrationKey:t.config.getPublishableKey(),ebanx_session_id:e.ebanx_session_id,providers:r},n=t.utils.api.resources.fingerPrintProvidersResource();t.http.ajax.request({url:n.url,method:n.method,data:i})},loadProvider:function(e,r){t.http.injectJS(e.source,function(){t.deviceFingerprint[e.provider].setup(e.settings,function(t){r({provider:e.provider,session_id:t})})})}},e.exports=t}])});